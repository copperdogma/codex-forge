run_id: ff-smoke
input:
  pdf: testdata/tbotb-mini.pdf
output_dir: /tmp/cf-smoke-ff

stages:
  - id: clean_pages
    stage: adapter
    module: load_stub_v1
    params:
      stub: testdata/smoke/ff/pages_clean.jsonl
      out: pages_clean.jsonl
      schema_version: clean_page_v1
  - id: regions
    stage: portionize
    module: portionize_regions_v1
    needs: [clean_pages]
    params:
      skip_ai: true
      stub: testdata/smoke/ff/regions.json
      window: 6
      stride: 4
      pages: testdata/smoke/ff/pages_clean.jsonl
      out: regions.json
  - id: headers
    stage: portionize
    module: portionize_headers_v1
    needs: [clean_pages, regions]
    params:
      skip_ai: true
      stub: testdata/smoke/ff/portion_hyp.jsonl
      window: 3
      stride: 1
      pages: testdata/smoke/ff/pages_clean.jsonl
      regions: testdata/smoke/ff/regions.json
      out: portion_hyp.jsonl
  - id: resolve_main
    stage: adapter
    module: portion_hyp_to_resolved_v1
    needs: [headers]
    params: {}
  - id: build_raw
    stage: build
    module: build_portions_v1
    needs: [clean_pages, resolve_main]
    inputs:
      pages: clean_pages
      portions: resolve_main
    out: portions_final_raw.json
    params: {}
