module_id: detect_boundaries_html_loop_v1
stage: portionize
entrypoint: modules/portionize/detect_boundaries_html_loop_v1/main.py
input_schema: page_html_v1
output_schema: page_html_v1
default_params:
  min_section: 1
  max_section: 400
  require_text_between: true
  include_background: true
  max_retries: 3
  html_only_retries: 1
  adjacent_scan_window: 2
  allow_missing: false
  repair_model: gpt-5.1
  repair_cache_dir: html_repair_cache
param_schema:
  properties:
    min_section:
      type: integer
      minimum: 1
    max_section:
      type: integer
      minimum: 1
    require_text_between:
      type: boolean
    include_background:
      type: boolean
    coarse_segments:
      type: string
    max_retries:
      type: integer
      minimum: 0
    html_only_retries:
      type: integer
      minimum: 0
    adjacent_scan_window:
      type: integer
      minimum: 0
    allow_missing:
      type: boolean
    repair_model:
      type: string
    repair_cache_dir:
      type: string
  required: [min_section, max_section]
notes: "Coverage guard + HTML-only repair loop for missing section headers (outputs repaired HTML)."
